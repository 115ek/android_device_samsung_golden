From f2e426d46250d9d5fc8feda0e4315622504e20bd Mon Sep 17 00:00:00 2001
From: Meticulus <theonejohnnyd@gmail.com>
Date: Tue, 26 Jul 2016 10:40:46 -0500
Subject: [PATCH] Bye Bye CMSTATS

Change-Id: I658b9372538d0bebbc504996b4eaf3aa7cdb01bf
---
 AndroidManifest.xml                                |   4 +-
 res/xml/privacy_settings_cyanogenmod.xml           |   4 +-
 src/com/android/settings/EnrollFingerprint.java    |  19 +-
 .../android/settings/SetupEnrollFingerprint.java   |   4 +-
 .../android/settings/cmstats/AnonymousStats.java   |  99 -------
 .../android/settings/cmstats/FingerprintStats.java | 129 ---------
 src/com/android/settings/cmstats/PreviewData.java  |  49 ----
 .../android/settings/cmstats/ReportingService.java | 106 --------
 .../settings/cmstats/ReportingServiceManager.java  | 123 ---------
 .../settings/cmstats/StatsUploadJobService.java    | 292 ---------------------
 src/com/android/settings/cmstats/StatsUtils.java   |  43 ---
 src/com/android/settings/cmstats/Utilities.java    | 102 -------
 .../settings/cyanogenmod/PrivacySettings.java      |   3 +-
 13 files changed, 18 insertions(+), 959 deletions(-)
 delete mode 100644 src/com/android/settings/cmstats/AnonymousStats.java
 delete mode 100644 src/com/android/settings/cmstats/FingerprintStats.java
 delete mode 100644 src/com/android/settings/cmstats/PreviewData.java
 delete mode 100644 src/com/android/settings/cmstats/ReportingService.java
 delete mode 100644 src/com/android/settings/cmstats/ReportingServiceManager.java
 delete mode 100644 src/com/android/settings/cmstats/StatsUploadJobService.java
 delete mode 100644 src/com/android/settings/cmstats/StatsUtils.java
 delete mode 100644 src/com/android/settings/cmstats/Utilities.java

diff --git a/AndroidManifest.xml b/AndroidManifest.xml
index c9af782..e4b52c4 100644
--- a/AndroidManifest.xml
+++ b/AndroidManifest.xml
@@ -2412,7 +2412,7 @@
             </intent-filter>
         </receiver>
 
-        <!-- Anonymous Statistics -->
+        <!-- Anonymous Statistics 
         <receiver android:name=".cmstats.ReportingServiceManager"
             android:enabled="true"
             android:exported="false"
@@ -2430,7 +2430,7 @@
         </service>
 
         <service android:name=".cmstats.StatsUploadJobService"
-                 android:permission="android.permission.BIND_JOB_SERVICE" />
+                 android:permission="android.permission.BIND_JOB_SERVICE" /> -->
 
         <!-- Watch for ContactsContract.Profile changes and update the user's photo.  -->
         <receiver android:name=".users.ProfileUpdateReceiver">
diff --git a/res/xml/privacy_settings_cyanogenmod.xml b/res/xml/privacy_settings_cyanogenmod.xml
index 7437b8c..50aa7e5 100644
--- a/res/xml/privacy_settings_cyanogenmod.xml
+++ b/res/xml/privacy_settings_cyanogenmod.xml
@@ -37,11 +37,11 @@
                     android:targetClass="org.whispersystems.whisperpush.ui.PreferenceActivity" />
         </Preference>
 
-        <!-- Anonymous statistics - (CMStats) -->
+        <!-- Anonymous statistics - (CMStats)
         <PreferenceScreen
             android:key="cmstats"
             android:title="@string/anonymous_statistics_title"
             android:summary="@string/anonymous_statistics_summary"
             android:fragment="com.android.settings.cmstats.AnonymousStats" >
-        </PreferenceScreen>
+        </PreferenceScreen> -->
 </PreferenceScreen>
diff --git a/src/com/android/settings/EnrollFingerprint.java b/src/com/android/settings/EnrollFingerprint.java
index 0b00525..5dd2b60 100644
--- a/src/com/android/settings/EnrollFingerprint.java
+++ b/src/com/android/settings/EnrollFingerprint.java
@@ -39,7 +39,6 @@ import android.widget.ImageView;
 import android.widget.ProgressBar;
 import android.widget.TextView;
 
-import com.android.settings.cmstats.FingerprintStats;
 import com.android.settings.cyanogenmod.FingerprintProgressBar;
 import com.android.setupwizard.navigationbar.SetupWizardNavBar;
 
@@ -329,10 +328,12 @@ public class EnrollFingerprint extends SettingsActivity
 
         @Override
         public void onNavigateBack() {
+	    /* GO EFF YOURSELF CMSTATS!
             if (mUiStage != Stage.EnrollmentFinished) {
                 FingerprintStats.sendFingerprintEnrollmentFailedEvent(getActivity(),
                         getStatsCategory(), FingerprintStats.FAILURE_REASON_CANCELED);
             }
+	    */
             switch (mUiStage) {
                 case EnrollmentStep:
                     break;
@@ -469,8 +470,8 @@ public class EnrollFingerprint extends SettingsActivity
                         mFpM.stopListening();
                         cancelEnrollmentStepTimeout();
                         showFailedEnrollmentDialog();
-                        FingerprintStats.sendFingerprintEnrollmentFailedEvent(getActivity(),
-                                getStatsCategory(), FingerprintStats.FAILURE_REASON_BAD_SCAN);
+                        //FingerprintStats.sendFingerprintEnrollmentFailedEvent(getActivity(),
+                        //        getStatsCategory(), FingerprintStats.FAILURE_REASON_BAD_SCAN);
                     }
                     break;
                 case EnrollmentFinished:
@@ -490,8 +491,8 @@ public class EnrollFingerprint extends SettingsActivity
                         setupBar.getBackButton().setVisibility(View.INVISIBLE);
                     }
 
-                    FingerprintStats.sendFingerprintEnrollmentSuccessEvent(getActivity(),
-                            getStatsCategory());
+                    //FingerprintStats.sendFingerprintEnrollmentSuccessEvent(getActivity(),
+                    //        getStatsCategory());
                     break;
             }
         }
@@ -499,11 +500,11 @@ public class EnrollFingerprint extends SettingsActivity
         protected EnrollFingerprint getEnrollmentActivity() {
             return (EnrollFingerprint) getActivity();
         }
-
+	/*
         protected String getStatsCategory() {
             return FingerprintStats.Categories.FINGERPRINT_ENROLLMENT_SETTINGS;
         }
-
+	*/
         private void showWrongSensorDialog() {
             DialogFragment dialogFragment = WrongSensorDialogFragment.newInstance();
             dialogFragment.show(getChildFragmentManager(), ERROR_DIALOG_TAG);
@@ -586,8 +587,8 @@ public class EnrollFingerprint extends SettingsActivity
                     mFpM.stopListening();
                     showFailedEnrollmentDialog();
                     updateStage(Stage.EnrollmentError);
-                    FingerprintStats.sendFingerprintEnrollmentFailedEvent(getActivity(),
-                            getStatsCategory(), FingerprintStats.FAILURE_REASON_TIMEOUT);
+                    //FingerprintStats.sendFingerprintEnrollmentFailedEvent(getActivity(),
+                    //        getStatsCategory(), FingerprintStats.FAILURE_REASON_TIMEOUT);
                 }
             }
         };
diff --git a/src/com/android/settings/SetupEnrollFingerprint.java b/src/com/android/settings/SetupEnrollFingerprint.java
index f86f11c..4036f36 100644
--- a/src/com/android/settings/SetupEnrollFingerprint.java
+++ b/src/com/android/settings/SetupEnrollFingerprint.java
@@ -28,7 +28,6 @@ import android.view.View;
 import android.view.ViewGroup;
 import android.widget.Button;
 import com.android.internal.widget.LockPatternUtils;
-import com.android.settings.cmstats.FingerprintStats;
 import com.android.setupwizard.navigationbar.SetupWizardNavBar;
 
 /**
@@ -181,10 +180,11 @@ public class SetupEnrollFingerprint extends EnrollFingerprint
                     super.onNavigateNext();
             }
         }
-
+	/*
         @Override
         protected String getStatsCategory() {
             return FingerprintStats.Categories.FINGERPRINT_ENROLLMENT_OOBE;
         }
+	*/
     }
 }
diff --git a/src/com/android/settings/cmstats/AnonymousStats.java b/src/com/android/settings/cmstats/AnonymousStats.java
deleted file mode 100644
index d85e24d..0000000
--- a/src/com/android/settings/cmstats/AnonymousStats.java
+++ /dev/null
@@ -1,99 +0,0 @@
-/*
- * Copyright (C) 2015 The CyanogenMod Project
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package com.android.settings.cmstats;
-
-import android.content.Context;
-import android.content.SharedPreferences;
-import android.os.Bundle;
-
-import android.os.UserHandle;
-import android.preference.Preference;
-import android.preference.PreferenceScreen;
-import android.preference.SwitchPreference;
-import com.android.settings.R;
-import com.android.settings.SettingsPreferenceFragment;
-import cyanogenmod.providers.CMSettings;
-
-public class AnonymousStats extends SettingsPreferenceFragment {
-
-    private static final String PREF_FILE_NAME = "CMStats";
-    /* package */ static final String ANONYMOUS_OPT_IN = "pref_anonymous_opt_in";
-    /* package */ static final String ANONYMOUS_LAST_CHECKED = "pref_anonymous_checked_in";
-
-    /* package */ static final String KEY_LAST_JOB_ID = "last_job_id";
-    /* package */ static final int QUEUE_MAX_THRESHOLD = 1000;
-
-    public static final String KEY_STATS = "stats_collection";
-
-    SwitchPreference mStatsSwitch;
-
-    public static SharedPreferences getPreferences(Context context) {
-        return context.getSharedPreferences(PREF_FILE_NAME, 0);
-    }
-
-    @Override
-    public void onCreate(Bundle savedInstanceState) {
-        super.onCreate(savedInstanceState);
-        addPreferencesFromResource(R.xml.anonymous_stats);
-        mStatsSwitch = (SwitchPreference) findPreference(KEY_STATS);
-    }
-
-    @Override
-    public boolean onPreferenceTreeClick(PreferenceScreen preferenceScreen, Preference preference) {
-        if (preference == mStatsSwitch) {
-            boolean checked = mStatsSwitch.isChecked();
-            if (checked) {
-                // clear opt out flags
-                CMSettings.Secure.putIntForUser(getContentResolver(),
-                        CMSettings.Secure.STATS_COLLECTION_REPORTED, 0, UserHandle.USER_OWNER);
-            }
-            // will initiate opt out sequence if necessary
-            ReportingServiceManager.setAlarm(getActivity());
-            return true;
-        }
-        return super.onPreferenceTreeClick(preferenceScreen, preference);
-    }
-
-    public static void updateLastSynced(Context context) {
-        getPreferences(context)
-                .edit()
-                .putLong(ANONYMOUS_LAST_CHECKED,System.currentTimeMillis())
-                .commit();
-    }
-
-    private static int getLastJobId(Context context) {
-        return getPreferences(context).getInt(KEY_LAST_JOB_ID, 0);
-    }
-
-    private static void setLastJobId(Context context, int id) {
-        getPreferences(context)
-                .edit()
-                .putInt(KEY_LAST_JOB_ID, id)
-                .commit();
-    }
-
-    public static int getNextJobId(Context context) {
-        int lastId = getLastJobId(context);
-        if (lastId >= QUEUE_MAX_THRESHOLD) {
-            lastId = 1;
-        } else {
-            lastId += 1;
-        }
-        setLastJobId(context, lastId);
-        return lastId;
-    }
-}
diff --git a/src/com/android/settings/cmstats/FingerprintStats.java b/src/com/android/settings/cmstats/FingerprintStats.java
deleted file mode 100644
index bf925d9..0000000
--- a/src/com/android/settings/cmstats/FingerprintStats.java
+++ /dev/null
@@ -1,129 +0,0 @@
-/*
- * Copyright (C) 2015 The CyanogenMod Project
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- * http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-package com.android.settings.cmstats;
-
-import android.content.Context;
-import android.content.Intent;
-import android.os.UserHandle;
-import android.util.Log;
-
-public class FingerprintStats {
-    private static final String TAG = FingerprintStats.class.getSimpleName();
-    private static final boolean DEBUG = false;
-    private static final String ANALYTIC_INTENT = "com.cyngn.stats.action.SEND_ANALYITC_EVENT";
-    private static final String ANALYTIC_PERMISSION = "com.cyngn.stats.SEND_ANALYTICS";
-    private static final String TRACKING_ID = "tracking_id";
-
-
-    /**
-     * Failed enrollment due to timeout of enrollment process
-     */
-    public static final String FAILURE_REASON_TIMEOUT = "timeout";
-
-    /**
-     * Failed enrollment due to bad fingerprint scans
-     */
-    public static final String FAILURE_REASON_BAD_SCAN = "bad_scan";
-
-    /**
-     * Failed enrollment due to user canceling enrollment process
-     */
-    public static final String FAILURE_REASON_CANCELED = "canceled";
-
-    private FingerprintStats() {}
-
-    public static void sendFingerprintEnrollmentFailedEvent(Context context, String category,
-            String failureReason) {
-        sendEvent(context, new Event(category, Actions.ACTION_ENROLLMENT_FAILED,
-                Labels.LABEL_FAILURE_REASON, failureReason));
-    }
-
-    public static void sendFingerprintEnrollmentSuccessEvent(Context context, String category) {
-        sendEvent(context, new Event(category, Actions.ACTION_ENROLLMENT_SUCCESS,
-                null, null));
-    }
-
-    private static void sendEvent(Context context, Event event) {
-
-        if (!StatsUtils.isStatsPackageInstalled(context)
-                || !StatsUtils.isStatsCollectionEnabled(context)) {
-            return;
-        }
-
-        // Create new intent
-        Intent intent = new Intent();
-        intent.setAction(ANALYTIC_INTENT);
-
-        // add tracking id
-        intent.putExtra(TRACKING_ID, context.getPackageName());
-        // append
-        intent.putExtra(Fields.EVENT_CATEGORY, event.category);
-        if (DEBUG) Log.d(TAG, Fields.EVENT_CATEGORY + "=" + event.category);
-        intent.putExtra(Fields.EVENT_ACTION, event.action);
-        if (DEBUG) Log.d(TAG, Fields.EVENT_ACTION + "=" + event.action);
-        // check if exist
-        if (event.label != null) {
-            intent.putExtra(Fields.EVENT_LABEL, event.label);
-            if (DEBUG) Log.d(TAG, Fields.EVENT_LABEL + "=" + event.label);
-        }
-
-        if (event.value != null) {
-            intent.putExtra(Fields.EVENT_VALUE, event.value);
-            if (DEBUG) Log.d(TAG, Fields.EVENT_VALUE + "=" + event.value);
-        }
-
-        // broadcast for internal package
-        context.sendBroadcastAsUser(intent,
-                new UserHandle(UserHandle.USER_CURRENT), ANALYTIC_PERMISSION);
-    }
-
-    private static final class Event {
-        private final String category;
-        private final String action;
-        private final String label;
-        private final String value;
-
-        public Event(String category, String action, String label, String value) {
-            this.action = action;
-            this.category = category;
-            this.label = label;
-            this.value = value;
-        }
-    }
-
-    public static final class Fields {
-        public static final String EVENT_CATEGORY = "category";
-        public static final String EVENT_ACTION = "action";
-        public static final String EVENT_LABEL = "label";
-        public static final String EVENT_VALUE = "value";
-    }
-
-    public static final class Categories {
-        public static final String FINGERPRINT_ENROLLMENT_SETTINGS =
-                "fingerprint_enrollment_settings";
-        public static final String FINGERPRINT_ENROLLMENT_OOBE =
-                "fingerprint_enrollment_oobe";
-    }
-
-    public static final class Actions {
-        public static final String ACTION_ENROLLMENT_SUCCESS = "enrollment_success";
-        public static final String ACTION_ENROLLMENT_FAILED = "enrollment_failed";
-    }
-
-    public static final class Labels {
-        public static final String LABEL_FAILURE_REASON = "failure_reason";
-    }
-}
diff --git a/src/com/android/settings/cmstats/PreviewData.java b/src/com/android/settings/cmstats/PreviewData.java
deleted file mode 100644
index 7a78aea..0000000
--- a/src/com/android/settings/cmstats/PreviewData.java
+++ /dev/null
@@ -1,49 +0,0 @@
-/*
- * Copyright (C) 2012 The CyanogenMod Project
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package com.android.settings.cmstats;
-
-import android.content.Context;
-import android.os.Bundle;
-import android.preference.Preference;
-import android.preference.PreferenceScreen;
-
-import com.android.settings.R;
-import com.android.settings.SettingsPreferenceFragment;
-
-public class PreviewData extends SettingsPreferenceFragment {
-    private static final String UNIQUE_ID = "preview_id";
-    private static final String DEVICE = "preview_device";
-    private static final String VERSION = "preview_version";
-    private static final String COUNTRY = "preview_country";
-    private static final String CARRIER = "preview_carrier";
-
-    @Override
-    public void onCreate(Bundle savedInstanceState) {
-        super.onCreate(savedInstanceState);
-
-        addPreferencesFromResource(R.xml.preview_data);
-
-        final PreferenceScreen prefSet = getPreferenceScreen();
-        final Context context = getActivity();
-
-        prefSet.findPreference(UNIQUE_ID).setSummary(Utilities.getUniqueID(context));
-        prefSet.findPreference(DEVICE).setSummary(Utilities.getDevice());
-        prefSet.findPreference(VERSION).setSummary(Utilities.getModVersion());
-        prefSet.findPreference(COUNTRY).setSummary(Utilities.getCountryCode(context));
-        prefSet.findPreference(CARRIER).setSummary(Utilities.getCarrier(context));
-    }
-}
diff --git a/src/com/android/settings/cmstats/ReportingService.java b/src/com/android/settings/cmstats/ReportingService.java
deleted file mode 100644
index 8410143..0000000
--- a/src/com/android/settings/cmstats/ReportingService.java
+++ /dev/null
@@ -1,106 +0,0 @@
-/*
- * Copyright (C) 2015 The CyanogenMod Project
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package com.android.settings.cmstats;
-
-import android.app.IntentService;
-import android.app.job.JobInfo;
-import android.app.job.JobScheduler;
-import android.content.ComponentName;
-import android.content.Context;
-import android.content.Intent;
-import android.os.PersistableBundle;
-import android.os.UserHandle;
-import android.util.Log;
-import cyanogenmod.providers.CMSettings;
-
-import java.util.List;
-
-public class ReportingService extends IntentService {
-    /* package */ static final String TAG = "CMStats";
-    private static final boolean DEBUG = Log.isLoggable(TAG, Log.DEBUG);
-
-    public static final String EXTRA_OPTING_OUT = "cmstats::opt_out";
-
-    public ReportingService() {
-        super(ReportingService.class.getSimpleName());
-    }
-
-    @Override
-    protected void onHandleIntent(Intent intent) {
-        JobScheduler js = (JobScheduler) getSystemService(Context.JOB_SCHEDULER_SERVICE);
-
-        String deviceId = Utilities.getUniqueID(getApplicationContext());
-        String deviceName = Utilities.getDevice();
-        String deviceVersion = Utilities.getModVersion();
-        String deviceCountry = Utilities.getCountryCode(getApplicationContext());
-        String deviceCarrier = Utilities.getCarrier(getApplicationContext());
-        String deviceCarrierId = Utilities.getCarrierId(getApplicationContext());
-        boolean optOut = intent.getBooleanExtra(EXTRA_OPTING_OUT, false);
-
-        final int cyanogenJobId = AnonymousStats.getNextJobId(getApplicationContext());
-        final int cmOrgJobId = AnonymousStats.getNextJobId(getApplicationContext());
-
-        if (DEBUG) Log.d(TAG, "scheduling jobs id: " + cyanogenJobId + ", " + cmOrgJobId);
-
-        PersistableBundle cyanogenBundle = new PersistableBundle();
-        cyanogenBundle.putBoolean(StatsUploadJobService.KEY_OPT_OUT, optOut);
-        cyanogenBundle.putString(StatsUploadJobService.KEY_DEVICE_NAME, deviceName);
-        cyanogenBundle.putString(StatsUploadJobService.KEY_UNIQUE_ID, deviceId);
-        cyanogenBundle.putString(StatsUploadJobService.KEY_VERSION, deviceVersion);
-        cyanogenBundle.putString(StatsUploadJobService.KEY_COUNTRY, deviceCountry);
-        cyanogenBundle.putString(StatsUploadJobService.KEY_CARRIER, deviceCarrier);
-        cyanogenBundle.putString(StatsUploadJobService.KEY_CARRIER_ID, deviceCarrierId);
-        cyanogenBundle.putLong(StatsUploadJobService.KEY_TIMESTAMP, System.currentTimeMillis());
-
-        // get snapshot and persist it
-        PersistableBundle cmBundle = new PersistableBundle(cyanogenBundle);
-
-        // set job types
-        cyanogenBundle.putInt(StatsUploadJobService.KEY_JOB_TYPE,
-                StatsUploadJobService.JOB_TYPE_CYANOGEN);
-        cmBundle.putInt(StatsUploadJobService.KEY_JOB_TYPE,
-                StatsUploadJobService.JOB_TYPE_CMORG);
-
-        // schedule cyanogen stats upload
-        js.schedule(new JobInfo.Builder(cyanogenJobId, new ComponentName(getPackageName(),
-                StatsUploadJobService.class.getName()))
-                .setRequiredNetworkType(JobInfo.NETWORK_TYPE_ANY)
-                .setMinimumLatency(1000)
-                .setExtras(cyanogenBundle)
-                .setPersisted(true)
-                .build());
-
-        // schedule cmorg stats upload
-        js.schedule(new JobInfo.Builder(cmOrgJobId, new ComponentName(getPackageName(),
-                StatsUploadJobService.class.getName()))
-                .setRequiredNetworkType(JobInfo.NETWORK_TYPE_ANY)
-                .setMinimumLatency(1000)
-                .setExtras(cmBundle)
-                .setPersisted(true)
-                .build());
-
-        if (optOut) {
-            // we've successfully scheduled the opt out.
-            CMSettings.Secure.putIntForUser(getContentResolver(),
-                    CMSettings.Secure.STATS_COLLECTION_REPORTED, 1, UserHandle.USER_OWNER);
-        }
-
-        // reschedule
-        AnonymousStats.updateLastSynced(this);
-        ReportingServiceManager.setAlarm(this);
-    }
-}
diff --git a/src/com/android/settings/cmstats/ReportingServiceManager.java b/src/com/android/settings/cmstats/ReportingServiceManager.java
deleted file mode 100644
index bce1372..0000000
--- a/src/com/android/settings/cmstats/ReportingServiceManager.java
+++ /dev/null
@@ -1,123 +0,0 @@
-/*
- * Copyright (C) 2012 The CyanogenMod Project
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package com.android.settings.cmstats;
-
-import android.app.AlarmManager;
-import android.app.PendingIntent;
-import android.app.job.JobScheduler;
-import android.content.BroadcastReceiver;
-import android.content.Context;
-import android.content.Intent;
-import android.content.SharedPreferences;
-import android.os.UserHandle;
-import android.util.Log;
-import cyanogenmod.providers.CMSettings;
-
-public class ReportingServiceManager extends BroadcastReceiver {
-    private static final long MILLIS_PER_HOUR = 60L * 60L * 1000L;
-    private static final long MILLIS_PER_DAY = 24L * MILLIS_PER_HOUR;
-    private static final long UPDATE_INTERVAL = 1L * MILLIS_PER_DAY;
-
-    private static final String TAG = ReportingServiceManager.class.getSimpleName();
-
-    public static final String ACTION_LAUNCH_SERVICE =
-            "com.android.settings.action.TRIGGER_REPORT_METRICS";
-    public static final String EXTRA_FORCE = "force";
-
-    @Override
-    public void onReceive(Context context, Intent intent) {
-        if (intent.getAction().equals(Intent.ACTION_BOOT_COMPLETED)) {
-            setAlarm(context);
-        } else if (intent.getAction().equals(ACTION_LAUNCH_SERVICE)){
-            launchService(context, intent.getBooleanExtra(EXTRA_FORCE, false));
-        }
-    }
-
-    /**
-     * opt out if we haven't yet
-     */
-    public static void initiateOptOut(Context context) {
-        final boolean optOutReported = CMSettings.Secure.getIntForUser(context.getContentResolver(),
-                CMSettings.Secure.STATS_COLLECTION_REPORTED, 0, UserHandle.USER_OWNER) == 1;
-        if (!optOutReported) {
-            Intent intent = new Intent();
-            intent.setClass(context, ReportingService.class);
-            intent.putExtra(ReportingService.EXTRA_OPTING_OUT, true);
-            context.startServiceAsUser(intent, UserHandle.OWNER);
-        }
-    }
-
-    public static void setAlarm(Context context) {
-        SharedPreferences prefs = AnonymousStats.getPreferences(context);
-        if (prefs.contains(AnonymousStats.ANONYMOUS_OPT_IN)) {
-            migrate(context, prefs);
-        }
-        if (!Utilities.isStatsCollectionEnabled(context)) {
-            initiateOptOut(context);
-            return;
-        }
-        long lastSynced = prefs.getLong(AnonymousStats.ANONYMOUS_LAST_CHECKED, 0);
-        if (lastSynced == 0) {
-            launchService(context, true); // service will reschedule the next alarm
-            return;
-        }
-        long millisFromNow = (lastSynced + UPDATE_INTERVAL) - System.currentTimeMillis();
-
-        Intent intent = new Intent(ACTION_LAUNCH_SERVICE);
-        intent.setClass(context, ReportingServiceManager.class);
-
-        AlarmManager alarmManager = (AlarmManager) context.getSystemService(Context.ALARM_SERVICE);
-        alarmManager.set(AlarmManager.RTC_WAKEUP, System.currentTimeMillis() + millisFromNow,
-                PendingIntent.getBroadcast(context, 0, intent, 0));
-        Log.d(TAG, "Next sync attempt in : "
-                + (millisFromNow / MILLIS_PER_HOUR) + " hours");
-    }
-
-    public static void launchService(Context context, boolean force) {
-        SharedPreferences prefs = AnonymousStats.getPreferences(context);
-
-        if (!Utilities.isStatsCollectionEnabled(context)) {
-            return;
-        }
-
-        if (!force) {
-            long lastSynced = prefs.getLong(AnonymousStats.ANONYMOUS_LAST_CHECKED, 0);
-            if (lastSynced == 0) {
-                setAlarm(context);
-                return;
-            }
-            long timeElapsed = System.currentTimeMillis() - lastSynced;
-            if (timeElapsed < UPDATE_INTERVAL) {
-                long timeLeft = UPDATE_INTERVAL - timeElapsed;
-                Log.d(TAG, "Waiting for next sync : "
-                        + timeLeft / MILLIS_PER_HOUR + " hours");
-                return;
-            }
-        }
-
-        Intent intent = new Intent();
-        intent.setClass(context, ReportingService.class);
-        context.startServiceAsUser(intent, UserHandle.OWNER);
-    }
-
-    private static void migrate(Context context, SharedPreferences prefs) {
-        Utilities.setStatsCollectionEnabled(context,
-                prefs.getBoolean(AnonymousStats.ANONYMOUS_OPT_IN, true));
-        prefs.edit().remove(AnonymousStats.ANONYMOUS_OPT_IN).commit();
-    }
-
-}
diff --git a/src/com/android/settings/cmstats/StatsUploadJobService.java b/src/com/android/settings/cmstats/StatsUploadJobService.java
deleted file mode 100644
index 77b26e6..0000000
--- a/src/com/android/settings/cmstats/StatsUploadJobService.java
+++ /dev/null
@@ -1,292 +0,0 @@
-/*
- * Copyright (C) 2015 The CyanogenMod Project
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package com.android.settings.cmstats;
-
-import android.app.job.JobParameters;
-import android.app.job.JobService;
-import android.net.Uri;
-import android.os.AsyncTask;
-import android.os.PersistableBundle;
-import android.util.ArrayMap;
-import android.util.Log;
-import com.android.settings.R;
-import org.json.JSONException;
-import org.json.JSONObject;
-
-import java.io.BufferedInputStream;
-import java.io.BufferedReader;
-import java.io.BufferedWriter;
-import java.io.IOException;
-import java.io.InputStream;
-import java.io.InputStreamReader;
-import java.io.OutputStream;
-import java.io.OutputStreamWriter;
-import java.net.HttpURLConnection;
-import java.net.URL;
-import java.util.Collections;
-import java.util.Map;
-
-public class StatsUploadJobService extends JobService {
-
-    private static final String TAG = StatsUploadJobService.class.getSimpleName();
-    private static final boolean DEBUG = Log.isLoggable(TAG, Log.DEBUG);
-
-    public static final String KEY_JOB_TYPE = "job_type";
-    public static final int JOB_TYPE_CYANOGEN = 1;
-    public static final int JOB_TYPE_CMORG = 2;
-
-    public static final String KEY_UNIQUE_ID = "uniqueId";
-    public static final String KEY_DEVICE_NAME = "deviceName";
-    public static final String KEY_VERSION = "version";
-    public static final String KEY_COUNTRY = "country";
-    public static final String KEY_CARRIER = "carrier";
-    public static final String KEY_CARRIER_ID = "carrierId";
-    public static final String KEY_TIMESTAMP = "timeStamp";
-    public static final String KEY_OPT_OUT = "optOut";
-
-    private final Map<JobParameters, StatsUploadTask> mCurrentJobs
-            = Collections.synchronizedMap(new ArrayMap<JobParameters, StatsUploadTask>());
-
-    @Override
-    public boolean onStartJob(JobParameters jobParameters) {
-        if (DEBUG)
-            Log.d(TAG, "onStartJob() called with " + "jobParameters = [" + jobParameters + "]");
-        final StatsUploadTask uploadTask = new StatsUploadTask(jobParameters);
-        mCurrentJobs.put(jobParameters, uploadTask);
-        uploadTask.execute((Void) null);
-        return true;
-    }
-
-    @Override
-    public boolean onStopJob(JobParameters jobParameters) {
-        if (DEBUG)
-            Log.d(TAG, "onStopJob() called with " + "jobParameters = [" + jobParameters + "]");
-
-        final StatsUploadTask cancelledJob;
-        cancelledJob = mCurrentJobs.remove(jobParameters);
-
-        if (cancelledJob != null) {
-            // cancel the ongoing background task
-            cancelledJob.cancel(true);
-            return true; // reschedule
-        }
-
-        return false;
-    }
-
-    private class StatsUploadTask extends AsyncTask<Void, Void, Void> {
-
-        private JobParameters mJobParams;
-
-        public StatsUploadTask(JobParameters jobParams) {
-            this.mJobParams = jobParams;
-        }
-
-        @Override
-        protected Void doInBackground(Void... params) {
-
-            PersistableBundle extras = mJobParams.getExtras();
-
-            String deviceId = extras.getString(KEY_UNIQUE_ID);
-            String deviceName = extras.getString(KEY_DEVICE_NAME);
-            String deviceVersion = extras.getString(KEY_VERSION);
-            String deviceCountry = extras.getString(KEY_COUNTRY);
-            String deviceCarrier = extras.getString(KEY_CARRIER);
-            String deviceCarrierId = extras.getString(KEY_CARRIER_ID);
-            long timeStamp = extras.getLong(KEY_TIMESTAMP);
-            boolean optOut = extras.getBoolean(KEY_OPT_OUT);
-
-            boolean success = false;
-            int jobType = extras.getInt(KEY_JOB_TYPE, -1);
-            if (!isCancelled()) {
-                switch (jobType) {
-                    case JOB_TYPE_CYANOGEN:
-                        try {
-                            JSONObject json = new JSONObject();
-                            json.put("optOut", optOut);
-                            json.put("uniqueId", deviceId);
-                            json.put("deviceName", deviceName);
-                            json.put("version", deviceVersion);
-                            json.put("country", deviceCountry);
-                            json.put("carrier", deviceCarrier);
-                            json.put("carrierId", deviceCarrierId);
-                            json.put("timestamp", timeStamp);
-
-                            success = uploadToCyanogen(json);
-                        } catch (IOException | JSONException e) {
-                            Log.e(TAG, "Could not upload stats checkin to cyanogen server", e);
-                            success = false;
-                        }
-                        break;
-
-                    case JOB_TYPE_CMORG:
-                        try {
-                            success = uploadToCM(deviceId, deviceName, deviceVersion, deviceCountry,
-                                    deviceCarrier, deviceCarrierId, optOut);
-                        } catch (IOException e) {
-                            Log.e(TAG, "Could not upload stats checkin to commnity server", e);
-                            success = false;
-                        }
-                        break;
-                }
-            }
-
-            if (success) {
-                // we hit the server, succeed either which way.
-                mCurrentJobs.remove(mJobParams);
-            }
-
-            if (DEBUG)
-                Log.d(TAG, "job id " + mJobParams.getJobId() + ", has finished with success="
-                        + success);
-            jobFinished(mJobParams, !success);
-            return null;
-        }
-    }
-
-
-    private boolean uploadToCM(String deviceId, String deviceName, String deviceVersion,
-                               String deviceCountry, String deviceCarrier, String deviceCarrierId,
-                               boolean optOut)
-            throws IOException {
-
-        final Uri uri = Uri.parse(getString(R.string.stats_cm_url)).buildUpon()
-                .appendQueryParameter("opt_out", optOut ? "1" : "0")
-                .appendQueryParameter("device_hash", deviceId)
-                .appendQueryParameter("device_name", deviceName)
-                .appendQueryParameter("device_version", deviceVersion)
-                .appendQueryParameter("device_country", deviceCountry)
-                .appendQueryParameter("device_carrier", deviceCarrier)
-                .appendQueryParameter("device_carrier_id", deviceCarrierId).build();
-        URL url = new URL(uri.toString());
-        HttpURLConnection urlConnection = (HttpURLConnection) url.openConnection();
-        try {
-            urlConnection.setInstanceFollowRedirects(true);
-            urlConnection.setDoOutput(true);
-            urlConnection.connect();
-
-            final int responseCode = urlConnection.getResponseCode();
-            if (DEBUG) Log.d(TAG, "cm server response code=" + responseCode);
-            final boolean success = responseCode == HttpURLConnection.HTTP_OK;
-            if (!success) {
-                Log.w(TAG, "failed sending, server returned: " + getResponse(urlConnection,
-                        !success));
-            }
-            return success;
-        } finally {
-            urlConnection.disconnect();
-        }
-
-    }
-
-    private boolean uploadToCyanogen(JSONObject json)
-            throws IOException, JSONException {
-        String authToken = getAuthToken();
-
-        if (authToken.isEmpty()) {
-            Log.w(TAG, "no auth token!");
-        }
-
-        URL url = new URL(getString(R.string.stats_cyanogen_url));
-        HttpURLConnection urlConnection = (HttpURLConnection) url.openConnection();
-        try {
-            urlConnection.setInstanceFollowRedirects(true);
-            urlConnection.setDoInput(true);
-            urlConnection.setDoOutput(true);
-
-            urlConnection.setRequestProperty("Accept-Encoding", "identity");
-            urlConnection.setRequestProperty("Authorization", authToken);
-            urlConnection.setRequestProperty("Content-Type", "application/json");
-
-            OutputStream os = urlConnection.getOutputStream();
-            BufferedWriter writer = new BufferedWriter(new OutputStreamWriter(os, "UTF-8"));
-            writer.write(json.toString());
-            writer.flush();
-            writer.close();
-            os.close();
-
-            urlConnection.connect();
-
-            final int responseCode = urlConnection.getResponseCode();
-            final boolean success = responseCode == HttpURLConnection.HTTP_OK;
-
-            final String response = getResponse(urlConnection, !success);
-            if (DEBUG)
-                Log.d(TAG, "server responseCode: " + responseCode +", response=" + response);
-
-            if (!success) {
-                Log.w(TAG, "failed sending, server returned: " + response);
-            }
-            return success;
-        } finally {
-            urlConnection.disconnect();
-        }
-    }
-
-    private String getAuthToken() {
-        HttpURLConnection urlConnection = null;
-        try {
-            URL url = new URL(getString(R.string.stats_cyanogen_token_url));
-            urlConnection = (HttpURLConnection) url.openConnection();
-            urlConnection.setInstanceFollowRedirects(true);
-            urlConnection.setDoInput(true);
-
-            urlConnection.setRequestProperty("Accept-Encoding", "identity");
-            urlConnection.setRequestProperty("Content-Type", "text/plain");
-
-            urlConnection.connect();
-
-            final int responseCode = urlConnection.getResponseCode();
-            final boolean success = responseCode == HttpURLConnection.HTTP_OK;
-            if (DEBUG) Log.d(TAG, "server auth response code=" + responseCode);
-            final String response = getResponse(urlConnection, !success);
-            if (DEBUG)
-                Log.d(TAG, "server auth response=" + response);
-
-            if (success) {
-                return response;
-            }
-        } catch (IOException e) {
-            Log.e(TAG, "error getting auth token", e);
-        } finally {
-            if (urlConnection != null) {
-                urlConnection.disconnect();
-            }
-        }
-        return "";
-    }
-
-    private String getResponse(HttpURLConnection httpUrlConnection, boolean errorStream)
-            throws IOException {
-        InputStream responseStream = new BufferedInputStream(errorStream
-                ? httpUrlConnection.getErrorStream()
-                : httpUrlConnection.getInputStream());
-
-        BufferedReader responseStreamReader = new BufferedReader(
-                new InputStreamReader(responseStream));
-        String line = "";
-        StringBuilder stringBuilder = new StringBuilder();
-        while ((line = responseStreamReader.readLine()) != null) {
-            stringBuilder.append(line).append("\n");
-        }
-        responseStreamReader.close();
-        responseStream.close();
-
-        return stringBuilder.toString();
-    }
-
-}
diff --git a/src/com/android/settings/cmstats/StatsUtils.java b/src/com/android/settings/cmstats/StatsUtils.java
deleted file mode 100644
index bc49fc9..0000000
--- a/src/com/android/settings/cmstats/StatsUtils.java
+++ /dev/null
@@ -1,43 +0,0 @@
-/*
- * Copyright (C) 2015 The CyanogenMod Project
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package com.android.settings.cmstats;
-
-import android.content.Context;
-import android.content.pm.ApplicationInfo;
-import android.content.pm.PackageInfo;
-import android.content.pm.PackageManager;
-
-import cyanogenmod.providers.CMSettings;
-
-public class StatsUtils {
-    private static final String STATS_PACKAGE = "com.cyngn.stats";
-
-    public static boolean isStatsCollectionEnabled(Context context) {
-        return CMSettings.Secure.getInt(context.getContentResolver(),
-                CMSettings.Secure.STATS_COLLECTION, 1) != 0;
-    }
-
-    public static boolean isStatsPackageInstalled(Context context) {
-        try {
-            PackageInfo pi = context.getPackageManager().getPackageInfo(STATS_PACKAGE, 0);
-            return pi.applicationInfo.enabled
-                    && ((pi.applicationInfo.flags & ApplicationInfo.FLAG_SYSTEM) != 0);
-        } catch (PackageManager.NameNotFoundException e) {
-            return false;
-        }
-    }
-}
diff --git a/src/com/android/settings/cmstats/Utilities.java b/src/com/android/settings/cmstats/Utilities.java
deleted file mode 100644
index 1e98888..0000000
--- a/src/com/android/settings/cmstats/Utilities.java
+++ /dev/null
@@ -1,102 +0,0 @@
-/*
- * Copyright (C) 2012 The CyanogenMod Project
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package com.android.settings.cmstats;
-
-import android.content.Context;
-import android.os.Build;
-import android.os.SystemProperties;
-import android.provider.Settings;
-import android.telephony.TelephonyManager;
-import android.text.TextUtils;
-
-import cyanogenmod.providers.CMSettings;
-
-import java.math.BigInteger;
-import java.net.NetworkInterface;
-import java.security.MessageDigest;
-
-public class Utilities {
-    public static String getUniqueID(Context context) {
-        final String id = Settings.Secure.getString(context.getContentResolver(), Settings.Secure.ANDROID_ID);
-        return digest(context.getPackageName() + id);
-    }
-
-    public static String getCarrier(Context context) {
-        TelephonyManager tm = (TelephonyManager) context.getSystemService(Context.TELEPHONY_SERVICE);
-        String carrier = tm.getNetworkOperatorName();
-        if (TextUtils.isEmpty(carrier)) {
-            carrier = "Unknown";
-        }
-        return carrier;
-    }
-
-    public static String getCarrierId(Context context) {
-        TelephonyManager tm = (TelephonyManager) context.getSystemService(Context.TELEPHONY_SERVICE);
-        String carrierId = tm.getNetworkOperator();
-        if (TextUtils.isEmpty(carrierId)) {
-            carrierId = "0";
-        }
-        return carrierId;
-    }
-
-    public static String getCountryCode(Context context) {
-        TelephonyManager tm = (TelephonyManager) context.getSystemService(Context.TELEPHONY_SERVICE);
-        String countryCode = tm.getNetworkCountryIso();
-        if (TextUtils.isEmpty(countryCode)) {
-            countryCode = "Unknown";
-        }
-        return countryCode;
-    }
-
-    public static String getDevice() {
-        return SystemProperties.get("ro.cm.device", Build.PRODUCT);
-    }
-
-    public static String getModVersion() {
-        return SystemProperties.get("ro.cm.version", Build.DISPLAY);
-    }
-
-    public static String digest(String input) {
-        try {
-            MessageDigest md = MessageDigest.getInstance("MD5");
-            return new BigInteger(1, md.digest(input.getBytes())).toString(16).toUpperCase();
-        } catch (Exception e) {
-            return null;
-        }
-    }
-
-    /**
-     * Check to see if global stats are enabled.
-     * @param context
-     * @return Whether or not stats collection is enabled.
-     */
-    public static boolean isStatsCollectionEnabled(Context context) {
-        return CMSettings.Secure.getInt(context.getContentResolver(),
-                CMSettings.Secure.STATS_COLLECTION, 1) != 0;
-    }
-
-    /**
-     * Enabled or disable stats collection
-     * @param context
-     * @param enabled Boolean that sets collection being enabled.
-     */
-    public static void setStatsCollectionEnabled(Context context, boolean enabled) {
-        int enable = (enabled) ? 1 : 0;
-        CMSettings.Secure.putInt(context.getContentResolver(),
-                CMSettings.Secure.STATS_COLLECTION, enable);
-    }
-}
diff --git a/src/com/android/settings/cyanogenmod/PrivacySettings.java b/src/com/android/settings/cyanogenmod/PrivacySettings.java
index 4806898..3cfbfae 100644
--- a/src/com/android/settings/cyanogenmod/PrivacySettings.java
+++ b/src/com/android/settings/cyanogenmod/PrivacySettings.java
@@ -64,11 +64,12 @@ public class PrivacySettings extends SettingsPreferenceFragment implements Index
         PackageManager pm = getPackageManager();
 
         boolean isOwner = Utils.isUserOwner();
+	/* Go eff yourself CMSTATS!
         if (!isOwner) {
             PreferenceScreen root = getPreferenceScreen();
             root.removePreference(findPreference(KEY_STATS));
         }
-
+	*/
         // Determine options based on device telephony support
         if (!pm.hasSystemFeature(PackageManager.FEATURE_TELEPHONY) || !isOwner) {
             // No telephony, remove dependent options
-- 
1.9.1

